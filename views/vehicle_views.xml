<odoo>
    <data>

        <record id="fleet_vehicle_view_form_inherit" model="ir.ui.view">
            <field name="name">fleet.vehicle.form</field>
            <field name="model">fleet.vehicle</field>
            <field name="inherit_id" ref="fleet.fleet_vehicle_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//form" position="replace">
                    <form string="Vehicle">
                        <header>
                            <field name="state_breakdown" widget="statusbar"
                                   options="{'clickable': '1', 'fold_field': 'fold'}"/>
                        </header>
                        <header>
                            <field name="state" widget="statusbar"/>
                        </header>

                        <sheet>
                            <field name="currency_id" invisible="1"/>
                            <div class="oe_button_box" name="button_box">
                                <button name="open_assignation_logs"
                                        type="object"
                                        class="oe_stat_button"
                                        icon="fa-history">
                                    <field name="history_count" widget="statinfo" string="Drivers History"/>
                                </button>
                                <button name="return_action_to_open"
                                        type="object"
                                        class="oe_stat_button"
                                        icon="fa-book"
                                        context="{'xml_id':'fleet_vehicle_log_contract_action'}"
                                        help="show the contract for this vehicle">
                                    <field name="contract_count" widget="statinfo" string="Contracts"/>
                                </button>
                                <button name="return_action_to_open"
                                        type="object"
                                        class="oe_stat_button"
                                        icon="fa-wrench"
                                        context="{'xml_id':'fleet_vehicle_log_services_action'}"
                                        help="show the services logs for this vehicle">
                                    <field name="service_count" widget="statinfo" string="Services"/>
                                </button>
                                <button name="return_action_to_open"
                                        type="object"
                                        class="oe_stat_button"
                                        icon="fa-tachometer"
                                        context="{'xml_id':'fleet_vehicle_odometer_action'}"
                                        help="show the odometer logs for this vehicle">
                                    <!--                                        attrs="{'invisible': [('vehicle_type', '!=', 'car')]}"-->

                                    <field name="odometer_count" widget="statinfo" string="Odometer"/>
                                </button>
                            </div>


                            <widget name="web_ribbon" title="Archived" bg_color="bg-danger"
                                    attrs="{'invisible': [('active', '=', True)]}"/>
                            <widget name="web_ribbon" title="Garantie" bg_color="bg-success"
                                    attrs="{'invisible': [('garantie', '=', False)]}"/>

                            <div class="oe_title machine-header">

                                <group col="2">


                                    <group>
                                        <label for="product_id" />
                                        <h4>
                                            <field name="product_id" class="oe_inline" options="{'no_create': True}"/>
                                        </h4>
                                        <label for="lot_id" options="{'no_create': True}"/>
                                        <h4>
                                            <field name="lot_id" class="oe_inline"/>
                                        </h4>
                                    </group>
                                    <group>
                                        <label for="license_plate" string="Numéro d'immatriculation"/>
                                        <h4>
                                            <field name="license_plate" class="oe_inline" required="0"/>
                                        </h4>
                                        <label for="company_id" string="Organisme"/>
                                        <h4>
                                            <field name="company_id"/>
                                        </h4>
                                    </group>
                                </group>

                                <field name="active" invisible="1"/>
                                <field name="garantie" invisible="1"/>
                            </div>
                            <hr/>
                            <div class="oe_right oe_button_box">
                                <!-- <button name="return_action_to_open"
                                     type="object"
                                     class="oe_stat_button"
                                     icon="fa-book"
                                     context="{'xml_id':'fleet_vehicle_log_contract_act'}"
                                     help="show the contract for this vehicle">
                                     <field name="contract_count" widget="statinfo" string="Contracts"/>
                                 </button>
                                 <button name="act_show_log_cost"
                                     type="object"
                                     class="oe_stat_button"
                                     icon="fa-usd"
                                     help="show all the costs for this vehicle"
                                     groups="fleet.group_fleet_manager">
                                     <field name="cost_count" widget="statinfo" string="Costs"/>
                                 </button>

                                 <button name="return_action_to_open_x"
                                     type="object"
                                     class="oe_stat_button"
                                     icon="fa-wrench"
                                     context="{'xml_id':'product_template_action'}"
                                     help="Voir les pièces affectées à cette machine" >
                                     <field name="affectation_count" widget="statinfo" string="Pièces de rechanges"/>
                                 </button>
                                 <button name="return_action_to_open_consumption"
                                     type="object"
                                     class="oe_stat_button"
                                     icon="fa-wrench"
                                     context="{'xml_id':'action_move_form2_consumption'}"
                                     help="Voir la consommation de cette machine">
                                     <field name="move_count" widget="statinfo" string="Consommation"/>
                                 </button>
                                 <button name="return_action_to_open"
                                     type="object"
                                     class="oe_stat_button"
                                     icon="fa-flask"
                                     context="{'xml_id':'fleet_vehicle_log_fuel2_act'}"
                                     help="Consommation de carburant mensuelle" >
                                     <field name="fuel_logs_count2" widget="statinfo" string="Carburant(Mois)"/>
                                 </button>

                                 <button name="return_action_to_open"
                                     type="object"
                                     class="oe_stat_button"
                                     icon=" "
                                     context="{'xml_id':'fleet_vehicle_chantier_affectation_action'}"
                                     help="Historique des affectations" >
                                     <field name="aff_chantier_count" widget="statinfo" string="Mouvements"/>
                                 </button>
                                 <button name="return_action_to_open"
                                     type="object"
                                     class="oe_stat_button"
                                     icon="fa-flask"
                                     context="{'xml_id':'fleet_vehicle_log_fuel_act'}"
                                     help="show the fuel logs for this vehicle" >
                                     <field name="fuel_logs_count" widget="statinfo" string="Fuel"/>
                                 </button>
                                 <button name="return_action_to_open"
                                     type="object"
                                     class="oe_stat_button"
                                     icon="fa-tachometer"
                                     context="{'xml_id':'fleet_vehicle_odometer_act'}"
                                     help="Voir les relevés du materiel" >
                                     <field name="odometer_count" widget="statinfo" string="Compteur"/>
                                 </button>
                                 <button name="return_action_to_open"
                                     type="object"
                                     class="oe_stat_button"
                                     icon=" "
                                     context="{'xml_id':'fleet_vehicle_modification_act'}"
                                     help="Voir les engins réliés" >
                                     <field name="related_count" widget="statinfo" string="Accrochages"/>
                                 </button>-->
                            </div>
                            <group col="2">
                                <group string="Affectation">
                                    <field name="driver_id" domain="['|', ('company_id', '=', False ), ('company_id', '=', company_id)]"/>
                                    <field name="chantier_id" options="{'no_create': True}"/>
                                    <field name="emplacement_chantier_id"  options="{'no_create': True}"/>
                                </group>
                                <group string="Observation">
                                    <field name="notes"/>
                                </group>
                            </group>
                            <hr/>
                            <group col="2">
                                <group string="Identification">
                                    <field name="location_id" options="{'no_create': True}"/>
                                    <field name="code"/>
                                    <field name="capacity"/>
                                    <field name="vin_sn"/>
                                    <field name="brand_id"/>
                                    <field name="designation_id"/>
                                    <field name="designation"/>
                                    <field name="category_id"/>
                                </group>
                                <group string="Moteur/Compteur">
                                    <label for="odometer"/>
                                    <div>
                                        <field name="odometer" class="oe_inline ml-1"/>
                                        <field name="odometer_unit" class="oe_inline"/>
                                    </div>
                                    <field name="pas_bouclage"/>
                                    <field name="seuil_bouclage"/>
                                    <field name="type_moteur"/>
                                    <field name="numero_moteur"/>
                                </group>


                            </group>
                            <hr/>
                            <group col="2" string="Contrat et Réglement">
                                <group>

                                    <field name="partner_id" options="{'no_create': True}"/>
                                    <field name="annee"/>
                                    <field name="contract_number"/>
                                    <field name="mode_reglement"/>
                                    <field name="folder"/>
                                    <field name="garantie_etat"/>
                                    <field name="date_debut_garantie" attrs="{'required':[('garantie','=',True)]}"/>
                                    <field name="date_fin_garantie"/>
                                    <field name="date_delivery"/>
                                    <field name="date_mise_service"/>

                                </group>
                                <group>
                                    <field name="date_acquisition"/>
                                    <field name="acquisition_date"/>
                                    <field name="acquisition_amount" widget="monetary"
                                           options="{'currency_field': 'currency_id'}"/>
                                    <field name="taxes_id"/>
                                    <field name="montant_tva" widget="monetary"/>
                                    <field name="montant_total" widget="monetary"/>

                                </group>
                            </group>

                        </sheet>
                        <div class="oe_chatter">
                            <field name="message_follower_ids"/>
                            <field name="activity_ids"/>
                            <field name="message_ids"/>
                        </div>
                    </form>
                </xpath>

            </field>
        </record>

        <record model='ir.ui.view' id='fleet_vehicle_modification_tree'>
            <field name="name">fleet.vehicle.modification.tree</field>
            <field name="model">fleet.vehicle.modification</field>
            <field name="arch" type="xml">
                <tree editable="top">
                    <field name="vehicle_id"/>
                    <field name="related_vehicle_id" domain="[('id','!=',vehicle_id)]" options="{'no_create': True}"/>
                    <field name="date"/>
                </tree>
            </field>
        </record>

        <record id="fleet_vehicle_modification_filter" model="ir.ui.view">
            <field name="name">fleet.vehicle.modification.select</field>
            <field name="model">fleet.vehicle.modification</field>
            <field name="arch" type="xml">
                <search>
                    <field name="vehicle_id"/>
                    <field name="related_vehicle_id"/>
                    <group expand="0" string="Group By">
                        <filter name="group_by_vehicle_id" string="Engins" context="{'group_by':'vehicle_id'}"/>
                        <filter name="group_by_related_vehicle_id" string="Engins reliés"
                                context="{'group_by':'related_vehicle_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id='fleet_vehicle_modification_act' model='ir.actions.act_window'>
            <field name="name">Accrochage</field>
            <field name="res_model">fleet.vehicle.modification</field>
            <field name="view_mode">tree,form</field>
        </record>

    </data>
</odoo>